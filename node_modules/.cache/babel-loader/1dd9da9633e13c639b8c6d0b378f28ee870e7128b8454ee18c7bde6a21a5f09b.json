{"ast":null,"code":"import { db } from '../../firebase/firebase';\nimport { collection, query, where, getDoc, doc, getDocs, updateDoc } from 'firebase/firestore';\nimport ApriFotocamera from '@/components/ApriFotocamera.vue';\nexport default {\n  name: \"AreaConvalidatore\",\n  data() {\n    return {\n      isLogged: null,\n      evento: \"\",\n      //Evento inteso come aliasEvento su AddEvento\n      password: \"\",\n      eventoId: \"\",\n      idPartecipante: \"\",\n      datiPartecipante: {\n        nome: \"\",\n        cognome: \"\",\n        dataNascita: \"\",\n        presenzaConfermata: null\n      }\n    };\n  },\n  components: {\n    ApriFotocamera\n  },\n  beforeMount() {\n    this.isLogged = false;\n  },\n  methods: {\n    async convalidatoreLogin() {\n      const q = query(collection(db, \"eventi\"), where(\"aliasEvento\", \"==\", this.evento), where(\"passwordConvalidatori\", \"==\", this.password));\n      const snapshot = await getDocs(q);\n      if (!snapshot.empty) {\n        this.eventoId = snapshot.docs[0].id;\n        localStorage.setItem(\"convalidatoreEvento\", this.evento);\n        localStorage.setItem(\"convalidatorePassword\", this.password);\n        localStorage.setItem(\"convalidatoreLogged\", \"true\");\n        this.isLogged = true;\n      } else {\n        alert(\"credenziali errate\");\n      }\n    },\n    gestisciQR(qrData) {\n      this.idPartecipante = qrData;\n      this.recuperaDatiPartecipante();\n    },\n    async recuperaDatiPartecipante() {\n      try {\n        const partecipanteRef = doc(db, \"eventi\", this.eventoId, \"partecipanti\", this.idPartecipante);\n        const snapshot = await getDoc(partecipanteRef);\n        if (snapshot.exists()) {\n          const data = snapshot.data();\n          this.datiPartecipante = {\n            nome: data.nome,\n            cognome: data.cognome,\n            dataNascita: data.data_di_nascita,\n            presenzaConfermata: data.presenzaConfermata\n          };\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n    async confermaPartecipazione() {\n      const partecipanteRef = doc(db, \"eventi\", this.eventoId, \"partecipanti\", this.idPartecipante);\n      try {\n        await updateDoc(partecipanteRef, {\n          presenzaConfermata: true\n        });\n        this.datiPartecipante.presenzaConfermata = true;\n      } catch (error) {\n        console.log(error);\n      }\n    }\n  }\n  // beforeUnmount() {\n  //     localStorage.removeItem(\"convalidatoreLogged\");\n  //     this.isLogged = false;\n  // }\n};","map":{"version":3,"names":["db","collection","query","where","getDoc","doc","getDocs","updateDoc","ApriFotocamera","name","data","isLogged","evento","password","eventoId","idPartecipante","datiPartecipante","nome","cognome","dataNascita","presenzaConfermata","components","beforeMount","methods","convalidatoreLogin","q","snapshot","empty","docs","id","localStorage","setItem","alert","gestisciQR","qrData","recuperaDatiPartecipante","partecipanteRef","exists","data_di_nascita","error","console","log","confermaPartecipazione"],"sources":["/Users/vladpostu/Desktop/easyticket/views/area_riservata/AreaConvalidatore.vue"],"sourcesContent":["<template>\n  <div class=\"area-convalidatore\">\n    <header>\n      <h2>{{ $t(\"validatorArea\") }}</h2>\n      <p class=\"subtitle\" v-if=\"!isLogged\">{{ $t(\"validatorAreaText\") }}</p>\n    </header>\n\n    <!-- LOGIN FORM -->\n    <div v-if=\"!isLogged\" class=\"form-container\">\n      <div class=\"form-group\">\n        <label for=\"alias_evento\">{{ $t(\"aliasEvent\") }}</label>\n        <input\n          v-model=\"evento\"\n          type=\"text\"\n          id=\"alias_evento\"\n          placeholder=\"\"\n        />\n      </div>\n\n      <div class=\"form-group\">\n        <label for=\"password_evento\">{{ $t(\"password\") }}</label>\n        <input\n          v-model=\"password\"\n          type=\"password\"\n          id=\"password_evento\"\n          placeholder=\"\"\n        />\n      </div>\n\n      <small class=\"form-text\">{{ $t(\"credentialsFromOrganizer\") }}</small>\n\n      <button class=\"btn-primary\" @click=\"convalidatoreLogin\">{{ $t(\"loginButton\") }}</button>\n    </div>\n\n    <!-- SEZIONE CONVALIDA -->\n    <div v-else class=\"scanner-section\">\n      <ApriFotocamera @emitQRCode=\"gestisciQR\" />\n\n      <div v-if=\"idPartecipante\" class=\"partecipante\">\n        <h4>{{ $t(\"infoParticipant\") }}</h4>\n        <div class=\"info\">\n          <div><strong>Nome:</strong> {{ datiPartecipante.nome }}</div>\n          <div><strong>Cognome:</strong> {{ datiPartecipante.cognome }}</div>\n          <div><strong>Data di nascita:</strong> {{ datiPartecipante.dataNascita }}</div>\n        </div>\n\n        <div class=\"conferma\">\n          <div v-if=\"datiPartecipante.presenzaConfermata\" class=\"alert alert-warning\">\n            Presenza gi√† confermata\n          </div>\n\n          <div v-else>\n            <p>I dati sono corretti?</p>\n            <button class=\"btn-confirm\" @click=\"confermaPartecipazione\">Conferma Presenza</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.area-convalidatore {\n  max-width: 400px;\n  margin: 50px auto;\n  padding: 0 20px 80px;\n  font-family: \"Inter\", system-ui, sans-serif;\n  color: #0C2B4E;\n}\n\nheader {\n  text-align: center;\n  margin-bottom: 40px;\n}\n\nh2 {\n  font-weight: 700;\n  color: #0C2B4E;\n  margin-bottom: 10px;\n}\n\n.subtitle {\n  color: #1D546C;\n  font-weight: 400;\n  font-size: 0.95rem;\n}\n\n/* --- FORM --- */\n.form-container {\n  background: #f8f9fa;\n  border-radius: 12px;\n  padding: 40px 30px;\n  box-shadow: rgba(0, 0, 0, 0.12) 0 5px 15px;\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n}\n\n.form-group {\n  display: flex;\n  flex-direction: column;\n}\n\n.form-group label {\n  font-weight: 600;\n  margin-bottom: 6px;\n  color: #0C2B4E;\n}\n\n.form-group input {\n  border: 1px solid #ccc;\n  border-radius: 6px;\n  padding: 8px 10px;\n  font-size: 0.95rem;\n  transition: all 0.2s ease;\n}\n\n.form-group input:focus {\n  outline: none;\n  border-color: #0C2B4E;\n  box-shadow: 0 0 4px rgba(12, 43, 78, 0.25);\n}\n\n.form-text {\n  font-size: 0.85rem;\n  color: #6c757d;\n  text-align: center;\n}\n\n.btn-primary {\n  background-color: #0C2B4E;\n  border: none;\n  color: #fff;\n  padding: 10px 22px;\n  border-radius: 8px;\n  font-weight: 600;\n  transition: background-color 0.3s ease;\n  cursor: pointer;\n  width: 100%;\n  position: relative;\n  left: 50%;\n  transform: translateX(-50%);\n}\n\n.btn-primary:hover {\n  background-color: #174170;\n}\n\n/* --- SEZIONE SCANNER --- */\n.scanner-section {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 40px;\n}\n\n/* --- PARTECIPANTE --- */\n.partecipante {\n  background-color: #1D546C;\n  color: #F4F4F4;\n  padding: 30px;\n  border-radius: 12px;\n  width: 100%;\n  box-shadow: rgba(0, 0, 0, 0.2) 0 8px 20px;\n}\n\n.partecipante h4 {\n  margin-bottom: 20px;\n  font-weight: 700;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.2);\n  padding-bottom: 10px;\n}\n\n.info div {\n  margin-bottom: 8px;\n  font-size: 1rem;\n}\n\n.conferma {\n  text-align: center;\n  margin-top: 25px;\n}\n\n.btn-confirm {\n  background-color: #28a745;\n  border: none;\n  padding: 10px 22px;\n  color: white;\n  font-weight: 600;\n  border-radius: 8px;\n  transition: background-color 0.3s ease;\n  cursor: pointer;\n}\n\n.btn-confirm:hover {\n  background-color: #218838;\n}\n\n/* --- ALERT --- */\n.alert {\n  padding: 10px;\n  border-radius: 6px;\n  font-weight: 500;\n}\n\n.alert-warning {\n  background-color: #fff3cd;\n  color: #856404;\n  border: 1px solid #ffeeba;\n}\n\n/* --- RESPONSIVE --- */\n@media (max-width: 500px) {\n  .form-container {\n    padding: 25px 20px;\n  }\n\n  .partecipante {\n    padding: 20px;\n  }\n\n  .btn-confirm,\n  .btn-primary {\n    padding: 10px;\n    font-size: 0.9rem;\n  }\n}\n</style>\n\n\n<script>\nimport { db } from '../../firebase/firebase';\nimport { collection, query, where, getDoc, doc, getDocs, updateDoc } from 'firebase/firestore';\nimport ApriFotocamera from '@/components/ApriFotocamera.vue';\n\nexport default {\n    name: \"AreaConvalidatore\",\n    data() {\n        return {\n            isLogged:  null,\n            evento: \"\", //Evento inteso come aliasEvento su AddEvento\n            password: \"\", \n            eventoId: \"\",\n            idPartecipante: \"\",\n            datiPartecipante: {\n                nome: \"\",\n                cognome: \"\",\n                dataNascita: \"\",\n                presenzaConfermata: null,\n            }\n        }\n    },\n\n    components: {\n        ApriFotocamera,\n    },\n \n    beforeMount() {\n        this.isLogged = false;\n    },\n    methods: {\n        async convalidatoreLogin() {\n            const q = query(\n                collection(db, \"eventi\"),\n                where(\"aliasEvento\", \"==\", this.evento),\n                where(\"passwordConvalidatori\", \"==\", this.password)\n            );\n\n            const snapshot = await getDocs(q);\n\n            if(!snapshot.empty) {\n                this.eventoId = snapshot.docs[0].id;\n                localStorage.setItem(\"convalidatoreEvento\", this.evento);\n                localStorage.setItem(\"convalidatorePassword\", this.password);\n                localStorage.setItem(\"convalidatoreLogged\", \"true\");\n                this.isLogged = true;\n            } else {\n                alert(\"credenziali errate\");\n            }\n        },\n        gestisciQR(qrData) {\n            this.idPartecipante = qrData;\n            this.recuperaDatiPartecipante();\n        },\n        async recuperaDatiPartecipante() {\n            try {\n                const partecipanteRef = doc(db, \"eventi\", this.eventoId, \"partecipanti\", this.idPartecipante)\n\n                const snapshot = await getDoc(partecipanteRef);\n\n                if(snapshot.exists()) {\n                    const data = snapshot.data();\n                    this.datiPartecipante = {\n                        nome: data.nome,\n                        cognome: data.cognome,\n                        dataNascita: data.data_di_nascita,\n                        presenzaConfermata: data.presenzaConfermata\n                    }\n                }\n            } catch(error) {\n                console.log(error)\n            }\n        },\n        async confermaPartecipazione() {\n            const partecipanteRef = doc(db, \"eventi\", this.eventoId, \"partecipanti\", this.idPartecipante)\n            \n            try {\n                await updateDoc(partecipanteRef, {\n                    presenzaConfermata: true,\n                });\n                this.datiPartecipante.presenzaConfermata = true\n            } catch(error) {\n                console.log(error)\n            }\n            \n        }\n    },\n    // beforeUnmount() {\n    //     localStorage.removeItem(\"convalidatoreLogged\");\n    //     this.isLogged = false;\n    // }\n}\n</script>\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}