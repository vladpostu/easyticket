{"ast":null,"code":"import { db } from '../../firebase/firebase';\nimport { collection, query, where, getDoc, doc, getDocs } from 'firebase/firestore';\nimport ApriFotocamera from '@/components/ApriFotocamera.vue';\nexport default {\n  name: \"AreaConvalidatore\",\n  data() {\n    return {\n      isLogged: null,\n      evento: \"\",\n      //Evento inteso come aliasEvento su AddEvento\n      password: \"\",\n      eventoId: \"\",\n      idPartecipante: \"\",\n      datiPartecipante: {\n        nome: \"\",\n        cognome: \"\",\n        dataNascita: \"\",\n        presenzaConfermata: null\n      }\n    };\n  },\n  components: {\n    ApriFotocamera\n  },\n  beforeMount() {\n    if (localStorage.getItem(\"convalidatoreLogged\")) {\n      this.isLogged = true;\n    }\n  },\n  methods: {\n    async convalidatoreLogin() {\n      const q = query(collection(db, \"eventi\"), where(\"aliasEvento\", \"==\", this.evento), where(\"passwordConvalidatori\", \"==\", this.password));\n      const snapshot = await getDocs(q);\n      if (!snapshot.empty) {\n        this.eventoId = snapshot.docs[0].id;\n        localStorage.setItem(\"convalidatoreEvento\", this.evento);\n        localStorage.setItem(\"convalidatorePassword\", this.password);\n        localStorage.setItem(\"convalidatoreLogged\", \"true\");\n        this.isLogged = true;\n      } else {\n        alert(\"credenziali errate\");\n      }\n    },\n    gestisciQR(qrData) {\n      this.idPartecipante = qrData;\n      this.recuperaDatiPartecipante();\n    },\n    async recuperaDatiPartecipante() {\n      const partecipanteRef = doc(db, \"eventi\", this.eventoId, \"partecipanti\", this.idPartecipante);\n      const snapshot = await getDoc(partecipanteRef);\n      if (snapshot.exists()) {\n        const data = snapshot.data();\n        this.datiPartecipante = {\n          nome: data.nome,\n          cognome: data.cognome,\n          dataNascita: data.data_di_nascita,\n          presenzaConfermata: data.presenzaConfermata\n        };\n      }\n    },\n    async confermaPartecipazione() {\n      const partecipanteRef = doc(db, \"eventi\", this.eventoId, \"partecipanti\", this.idPartecipante);\n      try {\n        await updateDoc(partecipanteRef, {\n          presenzaConfermata: true\n        });\n        this.datiPartecipante.presenzaConfermata = true;\n      } catch (error) {\n        console.log(error);\n      }\n    }\n  },\n  beforeUnmount() {\n    localStorage.removeItem(\"convalidatoreLogged\");\n    this.isLogged = false;\n  }\n};","map":{"version":3,"names":["db","collection","query","where","getDoc","doc","getDocs","ApriFotocamera","name","data","isLogged","evento","password","eventoId","idPartecipante","datiPartecipante","nome","cognome","dataNascita","presenzaConfermata","components","beforeMount","localStorage","getItem","methods","convalidatoreLogin","q","snapshot","empty","docs","id","setItem","alert","gestisciQR","qrData","recuperaDatiPartecipante","partecipanteRef","exists","data_di_nascita","confermaPartecipazione","updateDoc","error","console","log","beforeUnmount","removeItem"],"sources":["/Users/vladpostu/Desktop/easyticket/views/area_riservata/AreaConvalidatore.vue"],"sourcesContent":["<template>\n    <div class=\"form\" v-if=\"!isLogged\">\n        {{ isLogged }}\n\n        <input v-model=\"evento\" type=\"text\" placeholder=\"Evento\">\n        <input v-model=\"password\" type=\"text\" placeholder=\"password\">\n        <button @click=\"convalidatoreLogin\">login</button>\n    </div>\n    <div v-if=\"isLogged\">\n        <ApriFotocamera @emitQRCode=\"gestisciQR\"/>\n        \n        <div>\n            <div>Dettagli Partecipante</div>\n        <div>\n            <div>{{ idPartecipante }}</div>\n            <div> {{ datiPartecipante.nome }} </div>\n            <div> {{ datiPartecipante.cognome }} </div>\n            <div> {{ datiPartecipante.dataNascita }} </div>\n            <div> {{ datiPartecipante.presenzaConfermata }} </div>\n        </div>\n        <div class=\"conferma_partecipante\">\n            <div>I dati sono corretti?</div>\n            <div class=\"conferma-buttons\">\n                <button>Conferma</button>\n            </div>\n        </div>\n    </div>\n    </div>\n</template>\n\n<style>\n    .form {\n        display: flex;\n        flex-direction: column;\n        width: 300px;\n        align-items: center;\n        position: relative;\n        left: 50%;\n        transform: translateX(-50%);\n    }\n\n    .conferma-partecipante {\n        margin-top: 50px;\n    }\n\n    .conferma-buttons {\n        margin-top: 50px;\n    }\n\n    .conferma-buttons > button {\n        margin: 10px;\n    }\n\n</style>\n\n<script>\nimport { db } from '../../firebase/firebase';\nimport { collection, query, where, getDoc, doc, getDocs } from 'firebase/firestore';\nimport ApriFotocamera from '@/components/ApriFotocamera.vue';\n\nexport default {\n    name: \"AreaConvalidatore\",\n    data() {\n        return {\n            isLogged:  null,\n            evento: \"\", //Evento inteso come aliasEvento su AddEvento\n            password: \"\", \n            eventoId: \"\",\n            idPartecipante: \"\",\n            datiPartecipante: {\n                nome: \"\",\n                cognome: \"\",\n                dataNascita: \"\",\n                presenzaConfermata: null,\n            }\n        }\n    },\n\n    components: {\n        ApriFotocamera,\n    },\n \n    beforeMount() {\n        if(localStorage.getItem(\"convalidatoreLogged\")) {\n            this.isLogged = true;\n        }\n    },\n    methods: {\n        async convalidatoreLogin() {\n            const q = query(\n                collection(db, \"eventi\"),\n                where(\"aliasEvento\", \"==\", this.evento),\n                where(\"passwordConvalidatori\", \"==\", this.password)\n            );\n\n            const snapshot = await getDocs(q);\n\n            if(!snapshot.empty) {\n                this.eventoId = snapshot.docs[0].id;\n                localStorage.setItem(\"convalidatoreEvento\", this.evento);\n                localStorage.setItem(\"convalidatorePassword\", this.password);\n                localStorage.setItem(\"convalidatoreLogged\", \"true\");\n                this.isLogged = true;\n            } else {\n                alert(\"credenziali errate\");\n            }\n        },\n        gestisciQR(qrData) {\n            this.idPartecipante = qrData;\n            this.recuperaDatiPartecipante();\n        },\n        async recuperaDatiPartecipante() {\n            const partecipanteRef = doc(db, \"eventi\", this.eventoId, \"partecipanti\", this.idPartecipante)\n\n            const snapshot = await getDoc(partecipanteRef);\n\n            if(snapshot.exists()) {\n                const data = snapshot.data();\n                this.datiPartecipante = {\n                    nome: data.nome,\n                    cognome: data.cognome,\n                    dataNascita: data.data_di_nascita,\n                    presenzaConfermata: data.presenzaConfermata\n                }\n            }\n        },\n        async confermaPartecipazione() {\n            const partecipanteRef = doc(db, \"eventi\", this.eventoId, \"partecipanti\", this.idPartecipante)\n            \n            try {\n                await updateDoc(partecipanteRef, {\n                    presenzaConfermata: true,\n                });\n                this.datiPartecipante.presenzaConfermata = true\n            } catch(error) {\n                console.log(error)\n            }\n            \n        }\n    },\n    beforeUnmount() {\n        localStorage.removeItem(\"convalidatoreLogged\");\n        this.isLogged = false;\n    }\n}\n</script>\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}